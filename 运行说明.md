# ERP系统运行说明

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 运行项目

```bash
python app.py
```

### 3. 访问系统

打开浏览器访问：http://127.0.0.1:5000

## 功能说明

### 员工打卡功能

#### 主要功能
- ✅ 上班打卡
- ✅ 下班打卡
- ✅ 查询今日打卡记录
- ✅ 查询历史打卡记录
- ✅ 自动计算工作时长
- ✅ 自动判断迟到、早退状态

#### API接口

1. **上班打卡**
   - 方法: `POST`
   - 路径: `/api/attendance/checkin?user_id=1`
   - 说明: 记录员工上班时间

2. **下班打卡**
   - 方法: `POST`
   - 路径: `/api/attendance/checkout?user_id=1`
   - 说明: 记录员工下班时间，自动计算工作时长

3. **查询今日打卡记录**
   - 方法: `GET`
   - 路径: `/api/attendance/today?user_id=1`
   - 说明: 获取指定员工今天的打卡信息

4. **查询历史打卡记录**
   - 方法: `GET`
   - 路径: `/api/attendance/records?user_id=1&start_date=2024-01-01&end_date=2024-01-31&page=1&per_page=20`
   - 参数说明:
     - `user_id`: 用户ID（可选）
     - `start_date`: 开始日期，格式：YYYY-MM-DD（可选）
     - `end_date`: 结束日期，格式：YYYY-MM-DD（可选）
     - `page`: 页码，默认1（可选）
     - `per_page`: 每页数量，默认20（可选）

#### 打卡状态说明

- **normal**: 正常
- **late**: 迟到（超过9:30）
- **early_leave**: 早退
- **late_early_leave**: 迟到且早退
- **absent**: 缺勤（未打上班卡）

#### 默认账户

- 用户名: `admin`
- 密码: `admin123`（当前版本未实现密码验证，仅用于标识）
- 用户ID: `1`

## 数据库

系统使用SQLite数据库，数据库文件为 `erp.db`，首次运行会自动创建。

### 数据表结构

1. **users（用户表）**
   - id: 主键
   - username: 用户名（唯一）
   - password: 密码
   - name: 姓名
   - email: 邮箱
   - phone: 手机号
   - role: 角色（admin/employee）
   - status: 状态（active/inactive）

2. **attendance_records（打卡记录表）**
   - id: 主键
   - user_id: 用户ID（外键）
   - attendance_date: 打卡日期
   - check_in_time: 上班打卡时间
   - check_out_time: 下班打卡时间
   - work_hours: 工作时长（小时）
   - status: 打卡状态
   - remark: 备注

## 项目结构

```
erp/
├── app/                    # 应用主目录
│   ├── __init__.py        # 应用初始化
│   ├── config.py          # 配置文件
│   ├── models/            # 数据模型
│   │   ├── __init__.py
│   │   ├── user.py        # 用户模型
│   │   └── attendance.py  # 打卡记录模型
│   ├── views/             # 视图/路由
│   │   ├── __init__.py
│   │   ├── index.py       # 首页路由
│   │   └── attendance.py  # 打卡路由
│   └── utils/             # 工具函数
│       ├── __init__.py
│       └── helpers.py     # 辅助函数
├── app.py                 # 启动文件
├── requirements.txt       # 依赖包
├── .gitignore            # Git忽略文件
├── README.md             # 项目说明
├── plan.md               # 开发计划
└── erp.db                # SQLite数据库文件（自动生成）
```

## 注意事项

1. 首次运行会自动创建数据库和默认管理员账户
2. 当前版本为简化版，未实现JWT认证，通过user_id参数传递用户信息
3. 密码未加密存储，生产环境需要添加密码加密功能
4. 打卡时间判断基于系统时间，默认上班时间9:00，下班时间18:00

## 后续开发计划

- [ ] 实现JWT Token认证
- [ ] 密码加密存储（bcrypt）
- [ ] 用户注册和登录功能
- [ ] 角色权限管理
- [ ] 打卡记录导出（Excel）
- [ ] 打卡统计报表
- [ ] 请假、加班等功能

