# ERP系统 - 功能说明与目录结构

## 📋 已实现功能

### 1. 员工打卡系统 ✅

#### 核心功能
- **上班打卡**: 记录员工上班时间，自动判断是否迟到
- **下班打卡**: 记录员工下班时间，自动计算工作时长
- **打卡记录查询**: 支持查询今日和历史打卡记录
- **状态自动判断**: 
  - 正常 (normal)
  - 迟到 (late) - 超过9:30算迟到
  - 早退 (early_leave)
  - 迟到且早退 (late_early_leave)
  - 缺勤 (absent) - 未打上班卡

#### 业务逻辑
- 自动计算工作时长（小时）
- 防止重复打卡（同一天不能重复打上班/下班卡）
- 下班打卡前必须先打上班卡
- 支持分页查询历史记录

### 2. 用户管理 ✅

#### 功能
- 用户表结构设计
- 默认管理员账户自动创建
- 用户状态管理（激活/禁用）
- 角色管理（管理员/员工）

### 3. Web界面 ✅

#### 页面
- **首页** (`/`): 系统介绍和导航
- **打卡页面** (`/attendance`): 员工打卡操作界面
  - 选择员工
  - 上班/下班打卡按钮
  - 查询今日打卡记录
  - 实时显示打卡状态

### 4. RESTful API ✅

#### API接口
- `POST /api/attendance/checkin` - 上班打卡
- `POST /api/attendance/checkout` - 下班打卡
- `GET /api/attendance/today` - 查询今日打卡
- `GET /api/attendance/records` - 查询历史记录（支持分页、日期筛选）

#### 响应格式
统一JSON响应格式：
```json
{
  "code": 200,
  "message": "success",
  "data": {...}
}
```

## 📁 项目目录结构

```
erp/
├── app/                          # 应用主目录
│   ├── __init__.py              # Flask应用初始化（工厂模式）
│   ├── config.py                # 配置文件
│   │
│   ├── models/                  # 数据模型层
│   │   ├── __init__.py          # 模型导出
│   │   ├── user.py              # 用户模型（User）
│   │   └── attendance.py         # 打卡记录模型（AttendanceRecord）
│   │
│   ├── views/                    # 视图/路由层
│   │   ├── __init__.py          # 蓝图导出
│   │   ├── index.py             # 首页路由
│   │   └── attendance.py         # 打卡相关路由和API
│   │
│   └── utils/                    # 工具函数层
│       ├── __init__.py
│       └── helpers.py           # 辅助函数（响应格式化、装饰器）
│
├── instance/                     # 实例目录（自动生成）
│   └── erp.db                   # SQLite数据库文件
│
├── app.py                        # 应用启动入口
├── requirements.txt             # Python依赖包
├── environment.yml              # Conda环境配置
│
├── 启动脚本/
│   ├── start.bat                # Windows启动脚本
│   ├── start.sh                 # Linux/Mac启动脚本
│   ├── start_conda.bat          # Conda环境启动（Windows）
│   ├── start_conda.sh           # Conda环境启动（Linux/Mac）
│   ├── setup_conda.bat           # Conda环境配置（Windows）
│   └── setup_conda.sh           # Conda环境配置（Linux/Mac）
│
└── 文档/
    ├── README.md                # 项目说明
    ├── plan.md                  # 开发计划
    ├── 运行说明.md              # 运行说明
    ├── 快速开始.md              # 快速开始指南
    ├── conda使用说明.md         # Conda环境说明
    └── 启动说明.md              # 启动说明
```

## 🗄️ 数据库设计

### users 表（用户表）
- `id`: 主键
- `username`: 用户名（唯一）
- `password`: 密码
- `name`: 姓名
- `email`: 邮箱
- `phone`: 手机号
- `role`: 角色（admin/employee）
- `status`: 状态（active/inactive）
- `created_at`: 创建时间
- `updated_at`: 更新时间

### attendance_records 表（打卡记录表）
- `id`: 主键
- `user_id`: 用户ID（外键）
- `attendance_date`: 打卡日期
- `check_in_time`: 上班打卡时间
- `check_out_time`: 下班打卡时间
- `work_hours`: 工作时长（小时）
- `status`: 打卡状态
- `remark`: 备注
- `created_at`: 创建时间
- `updated_at`: 更新时间

## 🛠️ 技术栈

- **后端框架**: Flask 3.0.0
- **数据库**: SQLite（本地文件）
- **ORM**: Flask-SQLAlchemy 3.1.1
- **CORS**: Flask-CORS 4.0.0
- **环境管理**: Conda / Python venv
- **前端**: HTML5 + CSS3 + JavaScript（原生）

## 📊 代码统计

- **模型层**: 2个模型（User, AttendanceRecord）
- **API接口**: 4个RESTful接口
- **Web页面**: 2个页面（首页、打卡页）
- **工具函数**: 响应格式化、装饰器

## 🎯 设计特点

1. **模块化设计**: 清晰的分层架构（模型-视图-工具）
2. **工厂模式**: Flask应用使用工厂模式创建
3. **蓝图管理**: 使用Flask蓝图组织路由
4. **统一响应**: API响应格式统一
5. **错误处理**: 完善的异常处理机制
6. **自动初始化**: 首次运行自动创建数据库和默认账户

## 🚀 后续计划

根据 `plan.md`，后续将实现：
- 用户认证（JWT Token）
- 权限管理（RBAC）
- 库存管理
- 采购管理
- 销售管理
- 财务管理
- 报表统计

